<!DOCTYPE html>
<html
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:h="http://xmlns.jcp.org/jsf/html"
        xmlns:f="http://xmlns.jcp.org/jsf/core"
        xmlns:p="http://primefaces.org/ui">

<h:head>
  <title>Gestão de Pagamentos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
</h:head>

<h:body>
  <h:form id="formPrincipal">

    <p:messages id="messages" showDetail="true" closable="true"/>
    <div style="display:flex; justify-content:flex-end; margin-bottom:10px;">
      <p:link href="telainicial.xhtml" styleClass="p-button-text">
        <i class="pi pi-arrow-left" style="margin-right:5px;"></i>
        Voltar ao Menu Principal
      </p:link>
    </div>

    <p:panel header="Processar Pagamento" style="margin-bottom:15px">
      <div style="display:flex; gap:15px; flex-wrap:wrap; margin-bottom:10px;">
        <div style="display:flex; flex-direction:column;">
          <p:outputLabel value="Usuário:" for="usuario"/>
          <p:selectOneMenu id="usuario"
                           value="#{pagamentoBean.usuarioSelecionadoId}"
                           required="true" requiredMessage="Selecione um usuário">
            <f:selectItem itemLabel="Selecione um usuário" itemValue="" noSelectionOption="true"/>
            <f:selectItems value="#{pagamentoBean.usuarios}" var="u"
                           itemLabel="#{u.nome}" itemValue="#{u.id}"/>
          </p:selectOneMenu>
        </div>

        <div style="display:flex; flex-direction:column;">
          <p:outputLabel value="Produto:" for="produto"/>
          <p:selectOneMenu id="produto"
                           value="#{pagamentoBean.produtoSelecionadoId}"
                           required="true" requiredMessage="Selecione um produto">
            <f:selectItem  itemLabel="Selecione um produto"  itemValue="" noSelectionOption="true"/>
            <f:selectItems value="#{pagamentoBean.produtosDisponiveis}" var="p"
                           itemLabel="#{p.descricao} (#{p.quantidade} disponível)" itemValue="#{p.id}"/>
            <p:ajax listener="#{pagamentoBean.onProdutoChange}" update="messages"/>
          </p:selectOneMenu>
        </div>

        <div style="display:flex; flex-direction:column;">
          <p:outputLabel value="Quantidade:" for="quantidade"/>
          <p:inputNumber id="quantidade" value="#{pagamentoBean.quantidadeSolicitada}"
                         decimalPlaces="0" required="true" requiredMessage="Informe a quantidade"
                         minValue="1"/>
        </div>
      </div>
      <div style="display:flex; gap:10px;">
        <p:commandButton value="Processar"  icon="pi pi-check"
                         action="#{pagamentoBean.processarPagamento}"
                         update="formPrincipal"/>
        <p:commandButton value="Limpar"     icon="pi pi-times"
                         action="#{pagamentoBean.limpar}"
                         update="formPrincipal" immediate="true"/>
      </div>

    </p:panel>
    <p:panel header="Histórico de Pagamentos">
      <p:dataTable id="tabela" value="#{pagamentoBean.pagamentos}" var="pgto"
                   paginator="true" rows="10" emptyMessage="Nenhum pagamento encontrado">

        <p:column headerText="ID">
          <h:outputText value="#{pgto.id}"/>
        </p:column>

        <p:column headerText="Usuário">
          <h:outputText value="#{pgto.usuario.nome}"/>
        </p:column>

        <p:column headerText="Produto">
          <h:outputText value="#{pgto.produto.descricao}"/>
        </p:column>

        <p:column headerText="Código Produto">
          <h:outputText value="#{pgto.produto.codigo}"/>
        </p:column>

        <p:column headerText="Quantidade">
          <h:outputText value="#{pgto.quantidade}"/>
        </p:column>

        <p:column headerText="Data Pagamento">
          <h:outputText value="#{pgto.data_pagamento}">
            <f:convertDateTime pattern="dd/MM/yyyy"/>
          </h:outputText>
        </p:column>

        <p:column headerText="Data Entrega">
          <h:outputText value="#{pgto.data_entrega}">
            <f:convertDateTime pattern="dd/MM/yyyy"/>
          </h:outputText>
        </p:column>
      </p:dataTable>
    </p:panel>

  </h:form>
</h:body>


</html>
